<script src="firebase-config.js"></script>
<script>
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const taskDisplay = document.getElementById("taskDisplay");
  const today = new Date().toISOString().split("T")[0];

  auth.onAuthStateChanged(user => {
    if (user) {
      const uid = user.uid;
      console.log("Logged in UID:", uid);
      console.log("Today:", today);

      // ğŸ” Fetch Task from Firestore
      db.collection("tasks").doc(uid).collection(today).doc("task").get()
        .then(doc => {
          if (doc.exists) {
            console.log("ğŸ“Œ Task found:", doc.data());
            taskDisplay.innerText = doc.data().task;
          } else {
            console.warn("âŒ No task found for today.");
            taskDisplay.innerText = "âŒ No task assigned today.";
          }
        })
        .catch(err => {
          console.error("âš ï¸ Error getting task:", err);
          taskDisplay.innerText = "âš ï¸ Error loading task.";
        });

    } else {
      window.location.href = "login.html";
    }
  });

  function submitWork() {
    const summary = document.getElementById("summary").value.trim();
    if (!summary) {
      alert("Please enter your summary.");
      return;
    }

    const user = auth.currentUser;
    if (!user) return;

    const uid = user.uid;

    db.collection("tasks").doc(uid).collection(today).doc("summary").set({
      work: summary
    }).then(() => {
      alert("âœ… Work submitted!");
      document.getElementById("summary").value = "";
    }).catch(err => {
      console.error("âŒ Failed to save summary:", err);
      alert("âŒ Error submitting summary.");
    });
  }
</script>
